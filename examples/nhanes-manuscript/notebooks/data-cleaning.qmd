---
title: "Data Cleaning"
author: "Your Name"
date: today
format: html
---

## Overview

This document loads and cleans the NHANES data for our analysis examining the association between education level and blood pressure.

## Setup

```{r}
#| message: false

library(tidyverse)
library(NHANES)
library(here)
```

## Load Data

```{r}
# Load NHANES data from the NHANES package
# This dataset contains 10,000 observations from NHANES 2009-2012
data(NHANES)

# Check dimensions
dim(NHANES)
```

## Explore Variables

```{r}
# Key variables for our analysis
# Outcome: BPSysAve (average systolic blood pressure)
# Exposure: Education (educational attainment)
# Covariates: Age, Gender, Race1

# Check variable distributions
NHANES |>
  select(Age, Gender, Race1, Education, BPSysAve) |>
  summary()
```

## Data Cleaning

```{r}
data_clean <- NHANES |>
  # Select relevant variables
  select(ID, Age, Gender, Race1, Education, BPSysAve) |>
  # Restrict to adults aged 20 and older
  filter(Age >= 20) |>
  # Remove observations with missing values
  drop_na() |>
  # Convert Education to factor with clearer ordering
  mutate(
    Education = factor(Education, levels = c(
      "8th Grade",
      "9 - 11th Grade",
      "High School",
      "Some College",
      "College Grad"
    ))
  )

# Check final sample size
nrow(data_clean)
```

## Data Summary

```{r}
# Summary of cleaned data
summary(data_clean)
```

```{r}
# Distribution of education levels
data_clean |>
  count(Education) |>
  mutate(percent = n / sum(n) * 100)
```

## Save Cleaned Data

```{r}
# Save cleaned data for analysis
saveRDS(data_clean, here("results", "data_clean.rds"))

# Confirm save
cat("Cleaned data saved to", here("results", "data_clean.rds"), "\n")
cat("Final sample size:", nrow(data_clean), "participants\n")
```
